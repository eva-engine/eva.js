var e,t;e=this,t=function(e,t,r){"use strict";var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function o(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function i(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var p=e.length-1;p>=0;p--)(o=e[p])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function a(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}var p=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.sortDirty=!1,t.visible=!0,t.alpha=1,t.zIndex=0,t.sortableChildren=!1,t}return o(r,e),r.prototype.init=function(e){e&&Object.assign(this,e)},r.componentName="Render",i([t.decorators.IDEProp],r.prototype,"visible",void 0),i([t.decorators.IDEProp],r.prototype,"alpha",void 0),i([t.decorators.IDEProp],r.prototype,"zIndex",void 0),i([t.decorators.IDEProp],r.prototype,"sortableChildren",void 0),r}(t.Component),c=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Render",t}return o(n,e),n.prototype.init=function(){this.renderSystem=this.game.getSystem(r.RendererSystem),this.renderSystem.rendererManager.register(this)},n.prototype.rendererUpdate=function(e){var t=this,r=e.getComponent("Render"),n=this.containerManager.getContainer(e.id);if(n.alpha=r.alpha,n.visible=r.visible,r.sortDirty&&r.sortableChildren){var o=e.transform.children.map((function(e){return e.gameObject})).sort((function(e,t){var r=e.getComponent("Render"),n=t.getComponent("Render");return r?n?r.zIndex-n.zIndex:1:-1})).map((function(e){return t.containerManager.getContainer(e.id)})),i=this.containerManager.getContainer(r.gameObject.id).children,p=i.filter((function(e){return-1===o.indexOf(e)}));i.length=0,i.push.apply(i,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}(p,o)),r.sortDirty=!1}},n.prototype.componentChanged=function(e){e.type!==t.OBSERVER_TYPE.ADD&&e.type!==t.OBSERVER_TYPE.REMOVE||this.add(e),e.type===t.OBSERVER_TYPE.CHANGE&&this.change(e),e.type===t.OBSERVER_TYPE.REMOVE&&this.remove(e)},n.prototype.add=function(e){"Render"===e.component.name&&this.setDirty(e)},n.prototype.change=function(e){"Render"===e.component.name&&"zIndex"===e.prop.prop[0]&&this.setDirty(e)},n.prototype.remove=function(e){"Render"===e.component.name&&(this.containerManager.getContainer(e.gameObject.id).alpha=1)},n.prototype.setDirty=function(e){var t=e.gameObject.parent&&e.gameObject.parent.getComponent("Render");t&&(t.sortDirty=!0)},n.systemName="Render",n=i([t.decorators.componentObserver({Render:["zIndex"]})],n)}(r.Renderer);e.Render=p,e.RenderSystem=c,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@eva/eva.js"),require("@eva/plugin-renderer")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js","@eva/plugin-renderer"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).EVA=e.EVA||{},e.EVA.plugin=e.EVA.plugin||{},e.EVA.plugin.renderer=e.EVA.plugin.renderer||{},e.EVA.plugin.renderer.render={}),e.EVA,e.EVA.plugin.renderer);
