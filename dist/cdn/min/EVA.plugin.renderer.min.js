!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@eva/eva.js"),require("@eva/renderer-adapter"),require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js","@eva/renderer-adapter","pixi.js"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).EVA=e.EVA||{},e.EVA.plugin=e.EVA.plugin||{},e.EVA.plugin.renderer={}),e.EVA,e.EVA.rendererAdapter,e.PIXI)}(this,(function(e,t,r,n){"use strict";var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function a(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function c(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}function f(e,t){return e===t||e!=e&&t!=t}function p(e,t){for(var r=e.length;r--;)if(f(e[r][0],t))return r;return-1}var h=Array.prototype.splice;function v(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}v.prototype.clear=function(){this.__data__=[],this.size=0},v.prototype.delete=function(e){var t=this.__data__,r=p(t,e);return!(r<0)&&(r==t.length-1?t.pop():h.call(t,r,1),--this.size,!0)},v.prototype.get=function(e){var t=this.__data__,r=p(t,e);return r<0?void 0:t[r][1]},v.prototype.has=function(e){return p(this.__data__,e)>-1},v.prototype.set=function(e,t){var r=this.__data__,n=p(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var y="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},d="object"==typeof y&&y&&y.Object===Object&&y,_="object"==typeof self&&self&&self.Object===Object&&self,b=d||_||Function("return this")(),g=b.Symbol,m=Object.prototype,j=m.hasOwnProperty,w=m.toString,O=g?g.toStringTag:void 0;var E=Object.prototype.toString;var x=g?g.toStringTag:void 0;function A(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":x&&x in Object(e)?function(e){var t=j.call(e,O),r=e[O];try{e[O]=void 0;var n=!0}catch(e){}var o=w.call(e);return n&&(t?e[O]=r:delete e[O]),o}(e):function(e){return E.call(e)}(e)}function S(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function C(e){if(!S(e))return!1;var t=A(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var M,R=b["__core-js_shared__"],P=(M=/[^.]+$/.exec(R&&R.keys&&R.keys.IE_PROTO||""))?"Symbol(src)_1."+M:"";var T=Function.prototype.toString;function z(e){if(null!=e){try{return T.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var N=/^\[object .+?Constructor\]$/,D=Function.prototype,V=Object.prototype,k=D.toString,I=V.hasOwnProperty,L=RegExp("^"+k.call(I).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function B(e){return!(!S(e)||(t=e,P&&P in t))&&(C(e)?L:N).test(z(e));var t}function U(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return B(r)?r:void 0}var F=U(b,"Map"),Y=U(Object,"create");var W=Object.prototype.hasOwnProperty;var $=Object.prototype.hasOwnProperty;function q(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function G(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function K(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}q.prototype.clear=function(){this.__data__=Y?Y(null):{},this.size=0},q.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},q.prototype.get=function(e){var t=this.__data__;if(Y){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return W.call(t,e)?t[e]:void 0},q.prototype.has=function(e){var t=this.__data__;return Y?void 0!==t[e]:$.call(t,e)},q.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Y&&void 0===t?"__lodash_hash_undefined__":t,this},K.prototype.clear=function(){this.size=0,this.__data__={hash:new q,map:new(F||v),string:new q}},K.prototype.delete=function(e){var t=G(this,e).delete(e);return this.size-=t?1:0,t},K.prototype.get=function(e){return G(this,e).get(e)},K.prototype.has=function(e){return G(this,e).has(e)},K.prototype.set=function(e,t){var r=G(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function H(e){var t=this.__data__=new v(e);this.size=t.size}H.prototype.clear=function(){this.__data__=new v,this.size=0},H.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},H.prototype.get=function(e){return this.__data__.get(e)},H.prototype.has=function(e){return this.__data__.has(e)},H.prototype.set=function(e,t){var r=this.__data__;if(r instanceof v){var n=r.__data__;if(!F||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new K(n)}return r.set(e,t),this.size=r.size,this};function X(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new K;++t<r;)this.add(e[t])}function J(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}X.prototype.add=X.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},X.prototype.has=function(e){return this.__data__.has(e)};function Q(e,t,r,n,o,a){var i=1&r,c=e.length,s=t.length;if(c!=s&&!(i&&s>c))return!1;var u=a.get(e),l=a.get(t);if(u&&l)return u==t&&l==e;var f=-1,p=!0,h=2&r?new X:void 0;for(a.set(e,t),a.set(t,e);++f<c;){var v=e[f],y=t[f];if(n)var d=i?n(y,v,f,t,e,a):n(v,y,f,e,t,a);if(void 0!==d){if(d)continue;p=!1;break}if(h){if(!J(t,(function(e,t){if(i=t,!h.has(i)&&(v===e||o(v,e,r,n,a)))return h.push(t);var i}))){p=!1;break}}else if(v!==y&&!o(v,y,r,n,a)){p=!1;break}}return a.delete(e),a.delete(t),p}var Z=b.Uint8Array;function ee(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function te(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var re=g?g.prototype:void 0,ne=re?re.valueOf:void 0;var oe=Array.isArray;var ae=Object.prototype.propertyIsEnumerable,ie=Object.getOwnPropertySymbols,ce=ie?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a}(ie(e),(function(t){return ae.call(e,t)})))}:function(){return[]};function se(e){return null!=e&&"object"==typeof e}function ue(e){return se(e)&&"[object Arguments]"==A(e)}var le=Object.prototype,fe=le.hasOwnProperty,pe=le.propertyIsEnumerable,he=ue(function(){return arguments}())?ue:function(e){return se(e)&&fe.call(e,"callee")&&!pe.call(e,"callee")};var ve="object"==typeof e&&e&&!e.nodeType&&e,ye=ve&&"object"==typeof module&&module&&!module.nodeType&&module,de=ye&&ye.exports===ve?b.Buffer:void 0,_e=(de?de.isBuffer:void 0)||function(){return!1},be=/^(?:0|[1-9]\d*)$/;function ge(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&be.test(e))&&e>-1&&e%1==0&&e<t}function me(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}var je={};je["[object Float32Array]"]=je["[object Float64Array]"]=je["[object Int8Array]"]=je["[object Int16Array]"]=je["[object Int32Array]"]=je["[object Uint8Array]"]=je["[object Uint8ClampedArray]"]=je["[object Uint16Array]"]=je["[object Uint32Array]"]=!0,je["[object Arguments]"]=je["[object Array]"]=je["[object ArrayBuffer]"]=je["[object Boolean]"]=je["[object DataView]"]=je["[object Date]"]=je["[object Error]"]=je["[object Function]"]=je["[object Map]"]=je["[object Number]"]=je["[object Object]"]=je["[object RegExp]"]=je["[object Set]"]=je["[object String]"]=je["[object WeakMap]"]=!1;var we,Oe="object"==typeof e&&e&&!e.nodeType&&e,Ee=Oe&&"object"==typeof module&&module&&!module.nodeType&&module,xe=Ee&&Ee.exports===Oe&&d.process,Ae=function(){try{var e=Ee&&Ee.require&&Ee.require("util").types;return e||xe&&xe.binding&&xe.binding("util")}catch(e){}}(),Se=Ae&&Ae.isTypedArray,Ce=Se?(we=Se,function(e){return we(e)}):function(e){return se(e)&&me(e.length)&&!!je[A(e)]},Me=Object.prototype.hasOwnProperty;function Re(e,t){var r=oe(e),n=!r&&he(e),o=!r&&!n&&_e(e),a=!r&&!n&&!o&&Ce(e),i=r||n||o||a,c=i?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],s=c.length;for(var u in e)!t&&!Me.call(e,u)||i&&("length"==u||o&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ge(u,s))||c.push(u);return c}var Pe=Object.prototype;var Te=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),ze=Object.prototype.hasOwnProperty;function Ne(e){if(r=(t=e)&&t.constructor,t!==("function"==typeof r&&r.prototype||Pe))return Te(e);var t,r,n=[];for(var o in Object(e))ze.call(e,o)&&"constructor"!=o&&n.push(o);return n}function De(e){return null!=(t=e)&&me(t.length)&&!C(t)?Re(e):Ne(e);var t}function Ve(e){return function(e,t,r){var n=t(e);return oe(e)?n:function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}(n,r(e))}(e,De,ce)}var ke=Object.prototype.hasOwnProperty;var Ie=U(b,"DataView"),Le=U(b,"Promise"),Be=U(b,"Set"),Ue=U(b,"WeakMap"),Fe="[object Map]",Ye="[object Promise]",We="[object Set]",$e="[object WeakMap]",qe="[object DataView]",Ge=z(Ie),Ke=z(F),He=z(Le),Xe=z(Be),Je=z(Ue),Qe=A;(Ie&&Qe(new Ie(new ArrayBuffer(1)))!=qe||F&&Qe(new F)!=Fe||Le&&Qe(Le.resolve())!=Ye||Be&&Qe(new Be)!=We||Ue&&Qe(new Ue)!=$e)&&(Qe=function(e){var t=A(e),r="[object Object]"==t?e.constructor:void 0,n=r?z(r):"";if(n)switch(n){case Ge:return qe;case Ke:return Fe;case He:return Ye;case Xe:return We;case Je:return $e}return t});var Ze=Qe,et="[object Arguments]",tt="[object Array]",rt="[object Object]",nt=Object.prototype.hasOwnProperty;function ot(e,t,r,n,o,a){var i=oe(e),c=oe(t),s=i?tt:Ze(e),u=c?tt:Ze(t),l=(s=s==et?rt:s)==rt,p=(u=u==et?rt:u)==rt,h=s==u;if(h&&_e(e)){if(!_e(t))return!1;i=!0,l=!1}if(h&&!l)return a||(a=new H),i||Ce(e)?Q(e,t,r,n,o,a):function(e,t,r,n,o,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new Z(e),new Z(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return f(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=ee;case"[object Set]":var s=1&n;if(c||(c=te),e.size!=t.size&&!s)return!1;var u=i.get(e);if(u)return u==t;n|=2,i.set(e,t);var l=Q(c(e),c(t),n,o,a,i);return i.delete(e),l;case"[object Symbol]":if(ne)return ne.call(e)==ne.call(t)}return!1}(e,t,s,r,n,o,a);if(!(1&r)){var v=l&&nt.call(e,"__wrapped__"),y=p&&nt.call(t,"__wrapped__");if(v||y){var d=v?e.value():e,_=y?t.value():t;return a||(a=new H),o(d,_,r,n,a)}}return!!h&&(a||(a=new H),function(e,t,r,n,o,a){var i=1&r,c=Ve(e),s=c.length;if(s!=Ve(t).length&&!i)return!1;for(var u=s;u--;){var l=c[u];if(!(i?l in t:ke.call(t,l)))return!1}var f=a.get(e),p=a.get(t);if(f&&p)return f==t&&p==e;var h=!0;a.set(e,t),a.set(t,e);for(var v=i;++u<s;){var y=e[l=c[u]],d=t[l];if(n)var _=i?n(d,y,l,t,e,a):n(y,d,l,e,t,a);if(!(void 0===_?y===d||o(y,d,r,n,a):_)){h=!1;break}v||(v="constructor"==l)}if(h&&!v){var b=e.constructor,g=t.constructor;b==g||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g||(h=!1)}return a.delete(e),a.delete(t),h}(e,t,r,n,o,a))}function at(e,t,r,n,o){return e===t||(null==e||null==t||!se(e)&&!se(t)?e!=e&&t!=t:ot(e,t,r,n,at,o))}var it=function(){function e(e){var t=e.game,r=e.rendererSystem;this.renderers=[],this.game=t,this.rendererSystem=r}return e.prototype.register=function(){for(var e,t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];try{for(var o=s(r),a=o.next();!a.done;a=o.next()){var i=a.value;i.game=this.game,i.rendererManager=this.rendererSystem.rendererManager,i.containerManager=this.rendererSystem.containerManager,this.renderers.push(i)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.componentChanged=function(e){var r,n,o=function(e){var r,n;try{for(var o=(r=void 0,s(a.renderers)),i=o.next();!i.done;i=o.next()){var c=i.value,u=c.observerInfo[e.componentName];if(u){if([t.OBSERVER_TYPE.ADD,t.OBSERVER_TYPE.REMOVE].indexOf(e.type)>-1){try{c.componentChanged&&c.componentChanged(e)}catch(t){console.error("gameObject: "+e.gameObject.name+", "+e.componentName+" is error.",e,t)}continue}if(u.findIndex((function(t){return r=t,n=e.prop,at(r,n);var r,n}))>-1)try{c.componentChanged&&c.componentChanged(e)}catch(t){console.error("gameObject: "+(e.gameObject&&e.gameObject.name)+", "+e.componentName+" is componentChanged error.",e,t)}}}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},a=this;try{for(var i=s(e),c=i.next();!c.done;c=i.next()){o(c.value)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},e.prototype.update=function(e){var t,r,n,o;try{for(var a=s(e.components),i=a.next();!i.done;i=a.next()){var c=i.value;try{for(var u=(n=void 0,s(this.renderers)),l=u.next();!l.done;l=u.next()){var f=l.value,p=[];if(f.observerInfo[c.name]&&-1===p.indexOf(e)){p.push(e);try{f.rendererUpdate&&f.rendererUpdate(e)}catch(t){console.info("gameObject: "+e.name+", "+c.name+" is update error",t)}}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e}(),ct=function(){function e(){this.containerMap={}}return e.prototype.addContainer=function(e){var t=e.name,r=e.container;this.containerMap[t]=r},e.prototype.getContainer=function(e){return this.containerMap[e]},e.prototype.removeContainer=function(e){delete this.containerMap[e]},e.prototype.updateTransform=function(e){var t=e.name,r=e.transform,n=this.containerMap[t];if(n){var o=r.anchor,a=r.origin,i=r.position,c=r.rotation,s=r.scale,u=r.size,l=r.skew;n.rotation=c,n.scale=s,n.pivot.x=u.width*a.x,n.pivot.y=u.height*a.y,n.skew=l;var f=i.x,p=i.y;if(r.parent){var h=r.parent;f+=h.size.width*o.x,p+=h.size.height*o.y}n.position={x:f,y:p}}},e}();var st,ut=function(e){function n(t){var r=t.system,n=t.containerManager,o=e.call(this)||this;return o.name="Transform",o.waitRemoveIds=[],o.waitChangeScenes=[],o.containerManager=n,o.init(r),o}return a(n,e),n.prototype.init=function(e){var t=this;this.system=e,this.on("changeScene",(function(e){var r=e.scene,n=e.mode,o=e.application;t.waitChangeScenes.push({scene:r,mode:n,application:o})}))},n.prototype.update=function(){var e,t,r,n;try{for(var o=s(this.waitRemoveIds),a=o.next();!a.done;a=o.next()){var i=a.value;this.containerManager.removeContainer(i)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}this.waitRemoveIds=[];try{for(var c=s(this.waitChangeScenes),u=c.next();!u.done;u=c.next()){var l=u.value,f=this.containerManager.getContainer(l.scene.id);f&&(l.application.stage.removeChildren(),l.application.stage.addChild(f))}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}this.waitChangeScenes=[]},n.prototype.componentChanged=function(e){e.type===t.OBSERVER_TYPE.ADD?this.addContainer(e):e.type===t.OBSERVER_TYPE.CHANGE?this.change(e):e.type===t.OBSERVER_TYPE.REMOVE&&this.waitRemoveIds.push(e.gameObject.id)},n.prototype.addContainer=function(e){var t=new r.Container;t.name=e.gameObject.name,this.containerManager.addContainer({name:e.gameObject.id,container:t}),e.component.worldTransform=t.transform.worldTransform},n.prototype.change=function(e){var t=e.component;if(t.parent){this.containerManager.getContainer(t.parent.gameObject.id).addChild(this.containerManager.getContainer(e.gameObject.id));var r=e.gameObject.transform.parent&&e.gameObject.transform.parent.gameObject.getComponent("Render");r&&(r.sortDirty=!0)}else{var n=this.containerManager.getContainer(e.gameObject.id);n.parent&&n.parent.removeChild(n)}},n.prototype.destroy=function(){this.removeAllListeners(),this.waitRemoveIds=null,this.waitChangeScenes=null,this.system=null,this.containerManager=null},n=c([t.decorators.componentObserver({Transform:["_parent"]})],n)}(function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var c=new o(n,a||e,i),s=r?r+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],c]:e._events[s].push(c):(e._events[s]=c,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function c(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),c.prototype.eventNames=function(){var e,n,o=[];if(0===this._eventsCount)return o;for(n in e=this._events)t.call(e,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},c.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,a=n.length,i=new Array(a);o<a;o++)i[o]=n[o].fn;return i},c.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,o,a,i){var c=r?r+e:e;if(!this._events[c])return!1;var s,u,l=this._events[c],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,a),!0;case 6:return l.fn.call(l.context,t,n,o,a,i),!0}for(u=1,s=new Array(f-1);u<f;u++)s[u-1]=arguments[u];l.fn.apply(l.context,s)}else{var p,h=l.length;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),f){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,o);break;default:if(!s)for(p=1,s=new Array(f-1);p<f;p++)s[p-1]=arguments[p];l[u].fn.apply(l[u].context,s)}}return!0},c.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},c.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},c.prototype.removeListener=function(e,t,n,o){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return i(this,a),this;var c=this._events[a];if(c.fn)c.fn!==t||o&&!c.once||n&&c.context!==n||i(this,a);else{for(var s=0,u=[],l=c.length;s<l;s++)(c[s].fn!==t||o&&!c[s].once||n&&c[s].context!==n)&&u.push(c[s]);u.length?this._events[a]=1===u.length?u[0]:u:i(this,a)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&i(this,t)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,e.exports=c})));e.RENDERER_TYPE=void 0,(st=e.RENDERER_TYPE||(e.RENDERER_TYPE={}))[st.UNKNOWN=0]="UNKNOWN",st[st.WEBGL=1]="WEBGL",st[st.CANVAS=2]="CANVAS";var lt=function(e){e.plugins.interaction.autoPreventDefault=!0,e.view.style.touchAction="none"},ft=function(e){e.plugins.interaction.autoPreventDefault=!1,e.view.style.touchAction="auto"},pt=function(o){function u(){var e=null!==o&&o.apply(this,arguments)||this;return e.multiApps=[],e}return a(u,o),u.prototype.init=function(e){var r=this;this.params=e,this.application=this.createApplication(e),this.containerManager=new ct,this.rendererManager=new it({game:this.game,rendererSystem:this}),this.game.canvas=this.application.view,this.transform=new ut({system:this,containerManager:this.containerManager}),this.game.on("sceneChanged",(function(e){var n,o=e.scene,a=e.mode,i=e.params;switch(a){case t.LOAD_SCENE_MODE.SINGLE:n=r.application;break;case t.LOAD_SCENE_MODE.MULTI_CANVAS:n=r.createMultiApplication({params:i})}o.canvas=n.view,r.transform.emit("changeScene",{scene:o,mode:a,application:n})}))},u.prototype.registerObserver=function(e){var t,r=this.constructor.observerInfo;for(var n in e)r[n]||(r[n]=[]),(t=r[n]).push.apply(t,l(e[n]))},u.prototype.createMultiApplication=function(e){var t=e.params,r=this.createApplication(t);return this.multiApps.push(r),r},u.prototype.createApplication=function(t){t.view=t.canvas,t.renderType===e.RENDERER_TYPE.CANVAS&&(t.forceCanvas=!0),n.ticker.shared.autoStart=!1,n.ticker.shared.stop();var o=new r.Application(i({sharedTicker:!0},t));return void 0!==t.preventScroll&&(console.warn("PreventScroll property will deprecate at next major version, please use enableEnable instead. https://eva.js.org/#/tutorials/game"),t.preventScroll?ft(o.renderer):lt(o.renderer)),void 0!==t.enableScroll&&(t.enableScroll?ft(o.renderer):lt(o.renderer)),void 0===t.preventScroll&&void 0===t.enableScroll&&ft(o.renderer),o},u.prototype.update=function(e){var t,r,n,o,a=this.componentObserver.clear();try{for(var i=s(a),c=i.next();!c.done;c=i.next()){var u=c.value;this.transform.componentChanged(u)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}try{for(var l=s(this.game.gameObjects),f=l.next();!f.done;f=l.next()){var p=f.value;this.containerManager.updateTransform({name:p.id,transform:p.transform}),this.rendererManager.update(p)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}this.application.ticker.update(e.time)},u.prototype.lateUpdate=function(){this.transform.update()},u.prototype.onDestroy=function(){var e,t;this.application.destroy();try{for(var r=s(this.multiApps),n=r.next();!n.done;n=r.next()){var o=n.value;o&&o.destroy()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.transform.destroy(),this.transform=null,this.params=null,this.rendererManager=null,this.containerManager=null,this.application=null,this.game=null,this.multiApps=null},u.systemName="Renderer",u=c([t.decorators.componentObserver({Transform:["_parent"]})],u)}(t.System),ht=function(e){function t(){var t=e.call(this)||this;return t.observerInfo=t.constructor.observerInfo,t}return a(t,e),t.prototype.update=function(){var e,t,r=this.componentObserver.clear();try{for(var n=s(r),o=n.next();!o.done;o=n.next()){var a=o.value;this.componentChanged(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t}(t.System);e.ContainerManager=ct,e.Renderer=ht,e.RendererManager=it,e.RendererSystem=pt,Object.defineProperty(e,"__esModule",{value:!0})}));
