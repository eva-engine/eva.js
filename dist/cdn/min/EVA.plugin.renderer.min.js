!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@eva/eva.js"),require("@eva/renderer-adapter"),require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js","@eva/renderer-adapter","pixi.js"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).EVA=e.EVA||{},e.EVA.plugin=e.EVA.plugin||{},e.EVA.plugin.renderer={}),e.EVA,e.EVA.rendererAdapter,e.PIXI)}(this,(function(e,t,r,n){"use strict";var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function a(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function c(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i}function s(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}function f(e,t){return e===t||e!=e&&t!=t}function p(e,t){for(var r=e.length;r--;)if(f(e[r][0],t))return r;return-1}var h=Array.prototype.splice;function v(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}v.prototype.clear=function(){this.__data__=[],this.size=0},v.prototype.delete=function(e){var t=this.__data__,r=p(t,e);return!(r<0)&&(r==t.length-1?t.pop():h.call(t,r,1),--this.size,!0)},v.prototype.get=function(e){var t=this.__data__,r=p(t,e);return r<0?void 0:t[r][1]},v.prototype.has=function(e){return p(this.__data__,e)>-1},v.prototype.set=function(e,t){var r=this.__data__,n=p(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var y="object"==typeof global&&global&&global.Object===Object&&global,d="object"==typeof self&&self&&self.Object===Object&&self,_=y||d||Function("return this")(),b=_.Symbol,g=Object.prototype,m=g.hasOwnProperty,j=g.toString,w=b?b.toStringTag:void 0;var O=Object.prototype.toString;var E=b?b.toStringTag:void 0;function x(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":E&&E in Object(e)?function(e){var t=m.call(e,w),r=e[w];try{e[w]=void 0;var n=!0}catch(e){}var o=j.call(e);return n&&(t?e[w]=r:delete e[w]),o}(e):function(e){return O.call(e)}(e)}function A(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function S(e){if(!A(e))return!1;var t=x(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var C,M=_["__core-js_shared__"],R=(C=/[^.]+$/.exec(M&&M.keys&&M.keys.IE_PROTO||""))?"Symbol(src)_1."+C:"";var P=Function.prototype.toString;function T(e){if(null!=e){try{return P.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var z=/^\[object .+?Constructor\]$/,N=Function.prototype,D=Object.prototype,V=N.toString,k=D.hasOwnProperty,I=RegExp("^"+V.call(k).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function L(e){return!(!A(e)||(t=e,R&&R in t))&&(S(e)?I:z).test(T(e));var t}function B(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return L(r)?r:void 0}var U=B(_,"Map"),F=B(Object,"create");var Y=Object.prototype.hasOwnProperty;var W=Object.prototype.hasOwnProperty;function $(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function q(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function G(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}$.prototype.clear=function(){this.__data__=F?F(null):{},this.size=0},$.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},$.prototype.get=function(e){var t=this.__data__;if(F){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Y.call(t,e)?t[e]:void 0},$.prototype.has=function(e){var t=this.__data__;return F?void 0!==t[e]:W.call(t,e)},$.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=F&&void 0===t?"__lodash_hash_undefined__":t,this},G.prototype.clear=function(){this.size=0,this.__data__={hash:new $,map:new(U||v),string:new $}},G.prototype.delete=function(e){var t=q(this,e).delete(e);return this.size-=t?1:0,t},G.prototype.get=function(e){return q(this,e).get(e)},G.prototype.has=function(e){return q(this,e).has(e)},G.prototype.set=function(e,t){var r=q(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function K(e){var t=this.__data__=new v(e);this.size=t.size}K.prototype.clear=function(){this.__data__=new v,this.size=0},K.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},K.prototype.get=function(e){return this.__data__.get(e)},K.prototype.has=function(e){return this.__data__.has(e)},K.prototype.set=function(e,t){var r=this.__data__;if(r instanceof v){var n=r.__data__;if(!U||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new G(n)}return r.set(e,t),this.size=r.size,this};function H(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new G;++t<r;)this.add(e[t])}function X(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}H.prototype.add=H.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},H.prototype.has=function(e){return this.__data__.has(e)};function J(e,t,r,n,o,a){var i=1&r,c=e.length,s=t.length;if(c!=s&&!(i&&s>c))return!1;var u=a.get(e),l=a.get(t);if(u&&l)return u==t&&l==e;var f=-1,p=!0,h=2&r?new H:void 0;for(a.set(e,t),a.set(t,e);++f<c;){var v=e[f],y=t[f];if(n)var d=i?n(y,v,f,t,e,a):n(v,y,f,e,t,a);if(void 0!==d){if(d)continue;p=!1;break}if(h){if(!X(t,(function(e,t){if(i=t,!h.has(i)&&(v===e||o(v,e,r,n,a)))return h.push(t);var i}))){p=!1;break}}else if(v!==y&&!o(v,y,r,n,a)){p=!1;break}}return a.delete(e),a.delete(t),p}var Q=_.Uint8Array;function Z(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function ee(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var te=b?b.prototype:void 0,re=te?te.valueOf:void 0;var ne=Array.isArray;var oe=Object.prototype.propertyIsEnumerable,ae=Object.getOwnPropertySymbols,ie=ae?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a}(ae(e),(function(t){return oe.call(e,t)})))}:function(){return[]};function ce(e){return null!=e&&"object"==typeof e}function se(e){return ce(e)&&"[object Arguments]"==x(e)}var ue=Object.prototype,le=ue.hasOwnProperty,fe=ue.propertyIsEnumerable,pe=se(function(){return arguments}())?se:function(e){return ce(e)&&le.call(e,"callee")&&!fe.call(e,"callee")};var he="object"==typeof e&&e&&!e.nodeType&&e,ve=he&&"object"==typeof module&&module&&!module.nodeType&&module,ye=ve&&ve.exports===he?_.Buffer:void 0,de=(ye?ye.isBuffer:void 0)||function(){return!1},_e=/^(?:0|[1-9]\d*)$/;function be(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&_e.test(e))&&e>-1&&e%1==0&&e<t}function ge(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}var me={};me["[object Float32Array]"]=me["[object Float64Array]"]=me["[object Int8Array]"]=me["[object Int16Array]"]=me["[object Int32Array]"]=me["[object Uint8Array]"]=me["[object Uint8ClampedArray]"]=me["[object Uint16Array]"]=me["[object Uint32Array]"]=!0,me["[object Arguments]"]=me["[object Array]"]=me["[object ArrayBuffer]"]=me["[object Boolean]"]=me["[object DataView]"]=me["[object Date]"]=me["[object Error]"]=me["[object Function]"]=me["[object Map]"]=me["[object Number]"]=me["[object Object]"]=me["[object RegExp]"]=me["[object Set]"]=me["[object String]"]=me["[object WeakMap]"]=!1;var je,we="object"==typeof e&&e&&!e.nodeType&&e,Oe=we&&"object"==typeof module&&module&&!module.nodeType&&module,Ee=Oe&&Oe.exports===we&&y.process,xe=function(){try{var e=Oe&&Oe.require&&Oe.require("util").types;return e||Ee&&Ee.binding&&Ee.binding("util")}catch(e){}}(),Ae=xe&&xe.isTypedArray,Se=Ae?(je=Ae,function(e){return je(e)}):function(e){return ce(e)&&ge(e.length)&&!!me[x(e)]},Ce=Object.prototype.hasOwnProperty;function Me(e,t){var r=ne(e),n=!r&&pe(e),o=!r&&!n&&de(e),a=!r&&!n&&!o&&Se(e),i=r||n||o||a,c=i?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],s=c.length;for(var u in e)!t&&!Ce.call(e,u)||i&&("length"==u||o&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||be(u,s))||c.push(u);return c}var Re=Object.prototype;var Pe=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Te=Object.prototype.hasOwnProperty;function ze(e){if(r=(t=e)&&t.constructor,t!==("function"==typeof r&&r.prototype||Re))return Pe(e);var t,r,n=[];for(var o in Object(e))Te.call(e,o)&&"constructor"!=o&&n.push(o);return n}function Ne(e){return null!=(t=e)&&ge(t.length)&&!S(t)?Me(e):ze(e);var t}function De(e){return function(e,t,r){var n=t(e);return ne(e)?n:function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}(n,r(e))}(e,Ne,ie)}var Ve=Object.prototype.hasOwnProperty;var ke=B(_,"DataView"),Ie=B(_,"Promise"),Le=B(_,"Set"),Be=B(_,"WeakMap"),Ue="[object Map]",Fe="[object Promise]",Ye="[object Set]",We="[object WeakMap]",$e="[object DataView]",qe=T(ke),Ge=T(U),Ke=T(Ie),He=T(Le),Xe=T(Be),Je=x;(ke&&Je(new ke(new ArrayBuffer(1)))!=$e||U&&Je(new U)!=Ue||Ie&&Je(Ie.resolve())!=Fe||Le&&Je(new Le)!=Ye||Be&&Je(new Be)!=We)&&(Je=function(e){var t=x(e),r="[object Object]"==t?e.constructor:void 0,n=r?T(r):"";if(n)switch(n){case qe:return $e;case Ge:return Ue;case Ke:return Fe;case He:return Ye;case Xe:return We}return t});var Qe=Je,Ze="[object Arguments]",et="[object Array]",tt="[object Object]",rt=Object.prototype.hasOwnProperty;function nt(e,t,r,n,o,a){var i=ne(e),c=ne(t),s=i?et:Qe(e),u=c?et:Qe(t),l=(s=s==Ze?tt:s)==tt,p=(u=u==Ze?tt:u)==tt,h=s==u;if(h&&de(e)){if(!de(t))return!1;i=!0,l=!1}if(h&&!l)return a||(a=new K),i||Se(e)?J(e,t,r,n,o,a):function(e,t,r,n,o,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new Q(e),new Q(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return f(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=Z;case"[object Set]":var s=1&n;if(c||(c=ee),e.size!=t.size&&!s)return!1;var u=i.get(e);if(u)return u==t;n|=2,i.set(e,t);var l=J(c(e),c(t),n,o,a,i);return i.delete(e),l;case"[object Symbol]":if(re)return re.call(e)==re.call(t)}return!1}(e,t,s,r,n,o,a);if(!(1&r)){var v=l&&rt.call(e,"__wrapped__"),y=p&&rt.call(t,"__wrapped__");if(v||y){var d=v?e.value():e,_=y?t.value():t;return a||(a=new K),o(d,_,r,n,a)}}return!!h&&(a||(a=new K),function(e,t,r,n,o,a){var i=1&r,c=De(e),s=c.length;if(s!=De(t).length&&!i)return!1;for(var u=s;u--;){var l=c[u];if(!(i?l in t:Ve.call(t,l)))return!1}var f=a.get(e),p=a.get(t);if(f&&p)return f==t&&p==e;var h=!0;a.set(e,t),a.set(t,e);for(var v=i;++u<s;){var y=e[l=c[u]],d=t[l];if(n)var _=i?n(d,y,l,t,e,a):n(y,d,l,e,t,a);if(!(void 0===_?y===d||o(y,d,r,n,a):_)){h=!1;break}v||(v="constructor"==l)}if(h&&!v){var b=e.constructor,g=t.constructor;b==g||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g||(h=!1)}return a.delete(e),a.delete(t),h}(e,t,r,n,o,a))}function ot(e,t,r,n,o){return e===t||(null==e||null==t||!ce(e)&&!ce(t)?e!=e&&t!=t:nt(e,t,r,n,ot,o))}var at=function(){function e(e){var t=e.game,r=e.rendererSystem;this.renderers=[],this.game=t,this.rendererSystem=r}return e.prototype.register=function(){for(var e,t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];try{for(var o=s(r),a=o.next();!a.done;a=o.next()){var i=a.value;i.game=this.game,i.rendererManager=this.rendererSystem.rendererManager,i.containerManager=this.rendererSystem.containerManager,this.renderers.push(i)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.componentChanged=function(e){var r,n,o=function(e){var r,n;try{for(var o=(r=void 0,s(a.renderers)),i=o.next();!i.done;i=o.next()){var c=i.value,u=c.observerInfo[e.componentName];if(u){if([t.OBSERVER_TYPE.ADD,t.OBSERVER_TYPE.REMOVE].indexOf(e.type)>-1){try{c.componentChanged&&c.componentChanged(e)}catch(t){console.error("gameObject: "+e.gameObject.name+", "+e.componentName+" is error.",e,t)}continue}if(u.findIndex((function(t){return r=t,n=e.prop,ot(r,n);var r,n}))>-1)try{c.componentChanged&&c.componentChanged(e)}catch(t){console.error("gameObject: "+(e.gameObject&&e.gameObject.name)+", "+e.componentName+" is componentChanged error.",e,t)}}}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},a=this;try{for(var i=s(e),c=i.next();!c.done;c=i.next()){o(c.value)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},e.prototype.update=function(e){var t,r,n,o;try{for(var a=s(e.components),i=a.next();!i.done;i=a.next()){var c=i.value;try{for(var u=(n=void 0,s(this.renderers)),l=u.next();!l.done;l=u.next()){var f=l.value,p=[];if(f.observerInfo[c.name]&&-1===p.indexOf(e)){p.push(e);try{f.rendererUpdate&&f.rendererUpdate(e)}catch(t){console.info("gameObject: "+e.name+", "+c.name+" is update error",t)}}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e}(),it=function(){function e(){this.containerMap={}}return e.prototype.addContainer=function(e){var t=e.name,r=e.container;this.containerMap[t]=r},e.prototype.getContainer=function(e){return this.containerMap[e]},e.prototype.removeContainer=function(e){var t;null===(t=this.containerMap[e])||void 0===t||t.destroy({children:!0}),delete this.containerMap[e]},e.prototype.updateTransform=function(e){var t=e.name,r=e.transform,n=this.containerMap[t];if(n){var o=r.anchor,a=r.origin,i=r.position,c=r.rotation,s=r.scale,u=r.size,l=r.skew;n.rotation=c,n.scale=s,n.pivot.x=u.width*a.x,n.pivot.y=u.height*a.y,n.skew=l;var f=i.x,p=i.y;if(r.parent){var h=r.parent;f+=h.size.width*o.x,p+=h.size.height*o.y}n.position={x:f,y:p}}},e}();var ct,st=function(e){function n(t){var r=t.system,n=t.containerManager,o=e.call(this)||this;return o.name="Transform",o.waitRemoveIds=[],o.waitChangeScenes=[],o.containerManager=n,o.init(r),o}return a(n,e),n.prototype.init=function(e){var t=this;this.system=e,this.on("changeScene",(function(e){var r=e.scene,n=e.mode,o=e.application;t.waitChangeScenes.push({scene:r,mode:n,application:o})}))},n.prototype.update=function(){var e,t,r,n;try{for(var o=s(this.waitRemoveIds),a=o.next();!a.done;a=o.next()){var i=a.value;this.containerManager.removeContainer(i)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}this.waitRemoveIds=[];try{for(var c=s(this.waitChangeScenes),u=c.next();!u.done;u=c.next()){var l=u.value,f=this.containerManager.getContainer(l.scene.id);f&&(l.application.stage.removeChildren(),l.application.stage.addChild(f))}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}this.waitChangeScenes=[]},n.prototype.componentChanged=function(e){e.type===t.OBSERVER_TYPE.ADD?this.addContainer(e):e.type===t.OBSERVER_TYPE.CHANGE?this.change(e):e.type===t.OBSERVER_TYPE.REMOVE&&this.waitRemoveIds.push(e.gameObject.id)},n.prototype.addContainer=function(e){var t=new r.Container;t.name=e.gameObject.name,this.containerManager.addContainer({name:e.gameObject.id,container:t}),e.component.worldTransform=t.transform.worldTransform},n.prototype.change=function(e){var t=e.component;if(t.parent){this.containerManager.getContainer(t.parent.gameObject.id).addChild(this.containerManager.getContainer(e.gameObject.id));var r=e.gameObject.transform.parent&&e.gameObject.transform.parent.gameObject.getComponent("Render");r&&(r.sortDirty=!0)}else{var n=this.containerManager.getContainer(e.gameObject.id);delete t.worldTransform,n.parent&&n.parent.removeChild(n)}},n.prototype.destroy=function(){this.removeAllListeners(),this.waitRemoveIds=null,this.waitChangeScenes=null,this.system=null,this.containerManager=null},n=c([t.decorators.componentObserver({Transform:["_parent"]})],n)}(function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var c=new o(n,a||e,i),s=r?r+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],c]:e._events[s].push(c):(e._events[s]=c,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function c(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),c.prototype.eventNames=function(){var e,n,o=[];if(0===this._eventsCount)return o;for(n in e=this._events)t.call(e,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},c.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,a=n.length,i=new Array(a);o<a;o++)i[o]=n[o].fn;return i},c.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,o,a,i){var c=r?r+e:e;if(!this._events[c])return!1;var s,u,l=this._events[c],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,a),!0;case 6:return l.fn.call(l.context,t,n,o,a,i),!0}for(u=1,s=new Array(f-1);u<f;u++)s[u-1]=arguments[u];l.fn.apply(l.context,s)}else{var p,h=l.length;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),f){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,o);break;default:if(!s)for(p=1,s=new Array(f-1);p<f;p++)s[p-1]=arguments[p];l[u].fn.apply(l[u].context,s)}}return!0},c.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},c.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},c.prototype.removeListener=function(e,t,n,o){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return i(this,a),this;var c=this._events[a];if(c.fn)c.fn!==t||o&&!c.once||n&&c.context!==n||i(this,a);else{for(var s=0,u=[],l=c.length;s<l;s++)(c[s].fn!==t||o&&!c[s].once||n&&c[s].context!==n)&&u.push(c[s]);u.length?this._events[a]=1===u.length?u[0]:u:i(this,a)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&i(this,t)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,e.exports=c})));e.RENDERER_TYPE=void 0,(ct=e.RENDERER_TYPE||(e.RENDERER_TYPE={}))[ct.UNKNOWN=0]="UNKNOWN",ct[ct.WEBGL=1]="WEBGL",ct[ct.CANVAS=2]="CANVAS";var ut=function(e){e.plugins.interaction.autoPreventDefault=!0,e.view.style.touchAction="none"},lt=function(e){e.plugins.interaction.autoPreventDefault=!1,e.view.style.touchAction="auto"},ft=function(o){function u(){var e=null!==o&&o.apply(this,arguments)||this;return e.multiApps=[],e}return a(u,o),u.prototype.init=function(e){var r=this;this.params=e,this.application=this.createApplication(e),this.containerManager=new it,this.rendererManager=new at({game:this.game,rendererSystem:this}),this.game.canvas=this.application.view,this.transform=new st({system:this,containerManager:this.containerManager}),this.game.on("sceneChanged",(function(e){var n,o=e.scene,a=e.mode,i=e.params;switch(a){case t.LOAD_SCENE_MODE.SINGLE:n=r.application;break;case t.LOAD_SCENE_MODE.MULTI_CANVAS:n=r.createMultiApplication({params:i})}o.canvas=n.view,r.transform.emit("changeScene",{scene:o,mode:a,application:n})}))},u.prototype.registerObserver=function(e){var t,r=this.constructor.observerInfo;for(var n in e)r[n]||(r[n]=[]),(t=r[n]).push.apply(t,l(e[n]))},u.prototype.createMultiApplication=function(e){var t=e.params,r=this.createApplication(t);return this.multiApps.push(r),r},u.prototype.createApplication=function(t){t.view=t.canvas,t.renderType===e.RENDERER_TYPE.CANVAS&&(t.forceCanvas=!0),n.ticker.shared.autoStart=!1,n.ticker.shared.stop();var o=new r.Application(i({sharedTicker:!0},t));return void 0!==t.preventScroll&&(console.warn("PreventScroll property will deprecate at next major version, please use enableEnable instead. https://eva.js.org/#/tutorials/game"),t.preventScroll?lt(o.renderer):ut(o.renderer)),void 0!==t.enableScroll&&(t.enableScroll?lt(o.renderer):ut(o.renderer)),void 0===t.preventScroll&&void 0===t.enableScroll&&lt(o.renderer),o},u.prototype.update=function(){var e,t,r,n,o=this.componentObserver.clear();try{for(var a=s(o),i=a.next();!i.done;i=a.next()){var c=i.value;this.transform.componentChanged(c)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}try{for(var u=s(this.game.gameObjects),l=u.next();!l.done;l=u.next()){var f=l.value;this.containerManager.updateTransform({name:f.id,transform:f.transform}),this.rendererManager.update(f)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}},u.prototype.lateUpdate=function(e){this.transform.update(),this.application.ticker.update(e.time)},u.prototype.onDestroy=function(){var e,t;this.application.destroy();try{for(var r=s(this.multiApps),n=r.next();!n.done;n=r.next()){var o=n.value;o&&o.destroy()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.transform.destroy(),this.transform=null,this.params=null,this.rendererManager=null,this.containerManager=null,this.application=null,this.game=null,this.multiApps=null},u.systemName="Renderer",u=c([t.decorators.componentObserver({Transform:["_parent"]})],u)}(t.System),pt=function(e){function t(){var t=e.call(this)||this;return t.observerInfo=t.constructor.observerInfo,t}return a(t,e),t.prototype.update=function(){var e,t,r=this.componentObserver.clear();try{for(var n=s(r),o=n.next();!o.done;o=n.next()){var a=o.value;this.componentChanged(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t}(t.System);e.ContainerManager=it,e.Renderer=pt,e.RendererManager=at,e.RendererSystem=ft,Object.defineProperty(e,"__esModule",{value:!0})}));
