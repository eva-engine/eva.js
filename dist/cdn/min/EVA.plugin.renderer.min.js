!(function (e, t) {
  'object' == typeof exports && 'undefined' != typeof module
    ? t(exports, require('@eva/eva.js'), require('@eva/renderer-adapter'), require('pixi.js'))
    : 'function' == typeof define && define.amd
    ? define(['exports', '@eva/eva.js', '@eva/renderer-adapter', 'pixi.js'], t)
    : t(
        (((e = 'undefined' != typeof globalThis ? globalThis : e || self).EVA = e.EVA || {}),
        (e.EVA.plugin = e.EVA.plugin || {}),
        (e.EVA.plugin.renderer = {})),
        e.EVA,
        e.EVA.rendererAdapter,
        e.PIXI,
      );
})(this, function (e, t, r, n) {
  'use strict';
  function o(e, t, r, n) {
    var o,
      a = arguments.length,
      i = a < 3 ? t : null === n ? (n = Object.getOwnPropertyDescriptor(t, r)) : n;
    if ('object' == typeof Reflect && 'function' == typeof Reflect.decorate) i = Reflect.decorate(e, t, r, n);
    else for (var s = e.length - 1; s >= 0; s--) (o = e[s]) && (i = (a < 3 ? o(i) : a > 3 ? o(t, r, i) : o(t, r)) || i);
    return a > 3 && i && Object.defineProperty(t, r, i), i;
  }
  function a(e, t) {
    return e === t || (e != e && t != t);
  }
  function i(e, t) {
    for (var r = e.length; r--; ) if (a(e[r][0], t)) return r;
    return -1;
  }
  var s = Array.prototype.splice;
  function c(e) {
    var t = -1,
      r = null == e ? 0 : e.length;
    for (this.clear(); ++t < r; ) {
      var n = e[t];
      this.set(n[0], n[1]);
    }
  }
  (c.prototype.clear = function () {
    (this.__data__ = []), (this.size = 0);
  }),
    (c.prototype.delete = function (e) {
      var t = this.__data__,
        r = i(t, e);
      return !(r < 0) && (r == t.length - 1 ? t.pop() : s.call(t, r, 1), --this.size, !0);
    }),
    (c.prototype.get = function (e) {
      var t = this.__data__,
        r = i(t, e);
      return r < 0 ? void 0 : t[r][1];
    }),
    (c.prototype.has = function (e) {
      return i(this.__data__, e) > -1;
    }),
    (c.prototype.set = function (e, t) {
      var r = this.__data__,
        n = i(r, e);
      return n < 0 ? (++this.size, r.push([e, t])) : (r[n][1] = t), this;
    });
  var u = 'object' == typeof global && global && global.Object === Object && global,
    p = 'object' == typeof self && self && self.Object === Object && self,
    l = u || p || Function('return this')(),
    f = l.Symbol,
    h = Object.prototype,
    d = h.hasOwnProperty,
    v = h.toString,
    y = f ? f.toStringTag : void 0;
  var _ = Object.prototype.toString;
  var b = f ? f.toStringTag : void 0;
  function g(e) {
    return null == e
      ? void 0 === e
        ? '[object Undefined]'
        : '[object Null]'
      : b && b in Object(e)
      ? (function (e) {
          var t = d.call(e, y),
            r = e[y];
          try {
            e[y] = void 0;
            var n = !0;
          } catch (e) {}
          var o = v.call(e);
          return n && (t ? (e[y] = r) : delete e[y]), o;
        })(e)
      : (function (e) {
          return _.call(e);
        })(e);
  }
  function m(e) {
    var t = typeof e;
    return null != e && ('object' == t || 'function' == t);
  }
  function j(e) {
    if (!m(e)) return !1;
    var t = g(e);
    return (
      '[object Function]' == t || '[object GeneratorFunction]' == t || '[object AsyncFunction]' == t || '[object Proxy]' == t
    );
  }
  var O,
    w = l['__core-js_shared__'],
    E = (O = /[^.]+$/.exec((w && w.keys && w.keys.IE_PROTO) || '')) ? 'Symbol(src)_1.' + O : '';
  var A = Function.prototype.toString;
  function S(e) {
    if (null != e) {
      try {
        return A.call(e);
      } catch (e) {}
      try {
        return e + '';
      } catch (e) {}
    }
    return '';
  }
  var C = /^\[object .+?Constructor\]$/,
    x = Function.prototype,
    M = Object.prototype,
    R = x.toString,
    P = M.hasOwnProperty,
    T = RegExp(
      '^' +
        R.call(P)
          .replace(/[\\^$.*+?()[\]{}|]/g, '\\$&')
          .replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') +
        '$',
    );
  function z(e) {
    return !(!m(e) || ((t = e), E && E in t)) && (j(e) ? T : C).test(S(e));
    var t;
  }
  function N(e, t) {
    var r = (function (e, t) {
      return null == e ? void 0 : e[t];
    })(e, t);
    return z(r) ? r : void 0;
  }
  var D = N(l, 'Map'),
    V = N(Object, 'create');
  var k = Object.prototype.hasOwnProperty;
  var I = Object.prototype.hasOwnProperty;
  function L(e) {
    var t = -1,
      r = null == e ? 0 : e.length;
    for (this.clear(); ++t < r; ) {
      var n = e[t];
      this.set(n[0], n[1]);
    }
  }
  function B(e, t) {
    var r,
      n,
      o = e.__data__;
    return ('string' == (n = typeof (r = t)) || 'number' == n || 'symbol' == n || 'boolean' == n ? '__proto__' !== r : null === r)
      ? o['string' == typeof t ? 'string' : 'hash']
      : o.map;
  }
  function U(e) {
    var t = -1,
      r = null == e ? 0 : e.length;
    for (this.clear(); ++t < r; ) {
      var n = e[t];
      this.set(n[0], n[1]);
    }
  }
  (L.prototype.clear = function () {
    (this.__data__ = V ? V(null) : {}), (this.size = 0);
  }),
    (L.prototype.delete = function (e) {
      var t = this.has(e) && delete this.__data__[e];
      return (this.size -= t ? 1 : 0), t;
    }),
    (L.prototype.get = function (e) {
      var t = this.__data__;
      if (V) {
        var r = t[e];
        return '__lodash_hash_undefined__' === r ? void 0 : r;
      }
      return k.call(t, e) ? t[e] : void 0;
    }),
    (L.prototype.has = function (e) {
      var t = this.__data__;
      return V ? void 0 !== t[e] : I.call(t, e);
    }),
    (L.prototype.set = function (e, t) {
      var r = this.__data__;
      return (this.size += this.has(e) ? 0 : 1), (r[e] = V && void 0 === t ? '__lodash_hash_undefined__' : t), this;
    }),
    (U.prototype.clear = function () {
      (this.size = 0), (this.__data__ = {hash: new L(), map: new (D || c)(), string: new L()});
    }),
    (U.prototype.delete = function (e) {
      var t = B(this, e).delete(e);
      return (this.size -= t ? 1 : 0), t;
    }),
    (U.prototype.get = function (e) {
      return B(this, e).get(e);
    }),
    (U.prototype.has = function (e) {
      return B(this, e).has(e);
    }),
    (U.prototype.set = function (e, t) {
      var r = B(this, e),
        n = r.size;
      return r.set(e, t), (this.size += r.size == n ? 0 : 1), this;
    });
  function $(e) {
    var t = (this.__data__ = new c(e));
    this.size = t.size;
  }
  ($.prototype.clear = function () {
    (this.__data__ = new c()), (this.size = 0);
  }),
    ($.prototype.delete = function (e) {
      var t = this.__data__,
        r = t.delete(e);
      return (this.size = t.size), r;
    }),
    ($.prototype.get = function (e) {
      return this.__data__.get(e);
    }),
    ($.prototype.has = function (e) {
      return this.__data__.has(e);
    }),
    ($.prototype.set = function (e, t) {
      var r = this.__data__;
      if (r instanceof c) {
        var n = r.__data__;
        if (!D || n.length < 199) return n.push([e, t]), (this.size = ++r.size), this;
        r = this.__data__ = new U(n);
      }
      return r.set(e, t), (this.size = r.size), this;
    });
  function F(e) {
    var t = -1,
      r = null == e ? 0 : e.length;
    for (this.__data__ = new U(); ++t < r; ) this.add(e[t]);
  }
  function Y(e, t) {
    for (var r = -1, n = null == e ? 0 : e.length; ++r < n; ) if (t(e[r], r, e)) return !0;
    return !1;
  }
  (F.prototype.add = F.prototype.push = function (e) {
    return this.__data__.set(e, '__lodash_hash_undefined__'), this;
  }),
    (F.prototype.has = function (e) {
      return this.__data__.has(e);
    });
  function W(e, t, r, n, o, a) {
    var i = 1 & r,
      s = e.length,
      c = t.length;
    if (s != c && !(i && c > s)) return !1;
    var u = a.get(e),
      p = a.get(t);
    if (u && p) return u == t && p == e;
    var l = -1,
      f = !0,
      h = 2 & r ? new F() : void 0;
    for (a.set(e, t), a.set(t, e); ++l < s; ) {
      var d = e[l],
        v = t[l];
      if (n) var y = i ? n(v, d, l, t, e, a) : n(d, v, l, e, t, a);
      if (void 0 !== y) {
        if (y) continue;
        f = !1;
        break;
      }
      if (h) {
        if (
          !Y(t, function (e, t) {
            if (((i = t), !h.has(i) && (d === e || o(d, e, r, n, a)))) return h.push(t);
            var i;
          })
        ) {
          f = !1;
          break;
        }
      } else if (d !== v && !o(d, v, r, n, a)) {
        f = !1;
        break;
      }
    }
    return a.delete(e), a.delete(t), f;
  }
  var q = l.Uint8Array;
  function G(e) {
    var t = -1,
      r = Array(e.size);
    return (
      e.forEach(function (e, n) {
        r[++t] = [n, e];
      }),
      r
    );
  }
  function K(e) {
    var t = -1,
      r = Array(e.size);
    return (
      e.forEach(function (e) {
        r[++t] = e;
      }),
      r
    );
  }
  var H = f ? f.prototype : void 0,
    X = H ? H.valueOf : void 0;
  var J = Array.isArray;
  var Q = Object.prototype.propertyIsEnumerable,
    Z = Object.getOwnPropertySymbols,
    ee = Z
      ? function (e) {
          return null == e
            ? []
            : ((e = Object(e)),
              (function (e, t) {
                for (var r = -1, n = null == e ? 0 : e.length, o = 0, a = []; ++r < n; ) {
                  var i = e[r];
                  t(i, r, e) && (a[o++] = i);
                }
                return a;
              })(Z(e), function (t) {
                return Q.call(e, t);
              }));
        }
      : function () {
          return [];
        };
  function te(e) {
    return null != e && 'object' == typeof e;
  }
  function re(e) {
    return te(e) && '[object Arguments]' == g(e);
  }
  var ne = Object.prototype,
    oe = ne.hasOwnProperty,
    ae = ne.propertyIsEnumerable,
    ie = re(
      (function () {
        return arguments;
      })(),
    )
      ? re
      : function (e) {
          return te(e) && oe.call(e, 'callee') && !ae.call(e, 'callee');
        };
  var se = 'object' == typeof e && e && !e.nodeType && e,
    ce = se && 'object' == typeof module && module && !module.nodeType && module,
    ue = ce && ce.exports === se ? l.Buffer : void 0,
    pe =
      (ue ? ue.isBuffer : void 0) ||
      function () {
        return !1;
      },
    le = /^(?:0|[1-9]\d*)$/;
  function fe(e, t) {
    var r = typeof e;
    return (
      !!(t = null == t ? 9007199254740991 : t) &&
      ('number' == r || ('symbol' != r && le.test(e))) &&
      e > -1 &&
      e % 1 == 0 &&
      e < t
    );
  }
  function he(e) {
    return 'number' == typeof e && e > -1 && e % 1 == 0 && e <= 9007199254740991;
  }
  var de = {};
  (de['[object Float32Array]'] = de['[object Float64Array]'] = de['[object Int8Array]'] = de['[object Int16Array]'] = de[
    '[object Int32Array]'
  ] = de['[object Uint8Array]'] = de['[object Uint8ClampedArray]'] = de['[object Uint16Array]'] = de[
    '[object Uint32Array]'
  ] = !0),
    (de['[object Arguments]'] = de['[object Array]'] = de['[object ArrayBuffer]'] = de['[object Boolean]'] = de[
      '[object DataView]'
    ] = de['[object Date]'] = de['[object Error]'] = de['[object Function]'] = de['[object Map]'] = de['[object Number]'] = de[
      '[object Object]'
    ] = de['[object RegExp]'] = de['[object Set]'] = de['[object String]'] = de['[object WeakMap]'] = !1);
  var ve,
    ye = 'object' == typeof e && e && !e.nodeType && e,
    _e = ye && 'object' == typeof module && module && !module.nodeType && module,
    be = _e && _e.exports === ye && u.process,
    ge = (function () {
      try {
        var e = _e && _e.require && _e.require('util').types;
        return e || (be && be.binding && be.binding('util'));
      } catch (e) {}
    })(),
    me = ge && ge.isTypedArray,
    je = me
      ? ((ve = me),
        function (e) {
          return ve(e);
        })
      : function (e) {
          return te(e) && he(e.length) && !!de[g(e)];
        },
    Oe = Object.prototype.hasOwnProperty;
  function we(e, t) {
    var r = J(e),
      n = !r && ie(e),
      o = !r && !n && pe(e),
      a = !r && !n && !o && je(e),
      i = r || n || o || a,
      s = i
        ? (function (e, t) {
            for (var r = -1, n = Array(e); ++r < e; ) n[r] = t(r);
            return n;
          })(e.length, String)
        : [],
      c = s.length;
    for (var u in e)
      (!t && !Oe.call(e, u)) ||
        (i &&
          ('length' == u ||
            (o && ('offset' == u || 'parent' == u)) ||
            (a && ('buffer' == u || 'byteLength' == u || 'byteOffset' == u)) ||
            fe(u, c))) ||
        s.push(u);
    return s;
  }
  var Ee = Object.prototype;
  var Ae = (function (e, t) {
      return function (r) {
        return e(t(r));
      };
    })(Object.keys, Object),
    Se = Object.prototype.hasOwnProperty;
  function Ce(e) {
    if (((r = (t = e) && t.constructor), t !== (('function' == typeof r && r.prototype) || Ee))) return Ae(e);
    var t,
      r,
      n = [];
    for (var o in Object(e)) Se.call(e, o) && 'constructor' != o && n.push(o);
    return n;
  }
  function xe(e) {
    return null != (t = e) && he(t.length) && !j(t) ? we(e) : Ce(e);
    var t;
  }
  function Me(e) {
    return (function (e, t, r) {
      var n = t(e);
      return J(e)
        ? n
        : (function (e, t) {
            for (var r = -1, n = t.length, o = e.length; ++r < n; ) e[o + r] = t[r];
            return e;
          })(n, r(e));
    })(e, xe, ee);
  }
  var Re = Object.prototype.hasOwnProperty;
  var Pe = N(l, 'DataView'),
    Te = N(l, 'Promise'),
    ze = N(l, 'Set'),
    Ne = N(l, 'WeakMap'),
    De = '[object Map]',
    Ve = '[object Promise]',
    ke = '[object Set]',
    Ie = '[object WeakMap]',
    Le = '[object DataView]',
    Be = S(Pe),
    Ue = S(D),
    $e = S(Te),
    Fe = S(ze),
    Ye = S(Ne),
    We = g;
  ((Pe && We(new Pe(new ArrayBuffer(1))) != Le) ||
    (D && We(new D()) != De) ||
    (Te && We(Te.resolve()) != Ve) ||
    (ze && We(new ze()) != ke) ||
    (Ne && We(new Ne()) != Ie)) &&
    (We = function (e) {
      var t = g(e),
        r = '[object Object]' == t ? e.constructor : void 0,
        n = r ? S(r) : '';
      if (n)
        switch (n) {
          case Be:
            return Le;
          case Ue:
            return De;
          case $e:
            return Ve;
          case Fe:
            return ke;
          case Ye:
            return Ie;
        }
      return t;
    });
  var qe = We,
    Ge = '[object Arguments]',
    Ke = '[object Array]',
    He = '[object Object]',
    Xe = Object.prototype.hasOwnProperty;
  function Je(e, t, r, n, o, i) {
    var s = J(e),
      c = J(t),
      u = s ? Ke : qe(e),
      p = c ? Ke : qe(t),
      l = (u = u == Ge ? He : u) == He,
      f = (p = p == Ge ? He : p) == He,
      h = u == p;
    if (h && pe(e)) {
      if (!pe(t)) return !1;
      (s = !0), (l = !1);
    }
    if (h && !l)
      return (
        i || (i = new $()),
        s || je(e)
          ? W(e, t, r, n, o, i)
          : (function (e, t, r, n, o, i, s) {
              switch (r) {
                case '[object DataView]':
                  if (e.byteLength != t.byteLength || e.byteOffset != t.byteOffset) return !1;
                  (e = e.buffer), (t = t.buffer);
                case '[object ArrayBuffer]':
                  return !(e.byteLength != t.byteLength || !i(new q(e), new q(t)));
                case '[object Boolean]':
                case '[object Date]':
                case '[object Number]':
                  return a(+e, +t);
                case '[object Error]':
                  return e.name == t.name && e.message == t.message;
                case '[object RegExp]':
                case '[object String]':
                  return e == t + '';
                case '[object Map]':
                  var c = G;
                case '[object Set]':
                  var u = 1 & n;
                  if ((c || (c = K), e.size != t.size && !u)) return !1;
                  var p = s.get(e);
                  if (p) return p == t;
                  (n |= 2), s.set(e, t);
                  var l = W(c(e), c(t), n, o, i, s);
                  return s.delete(e), l;
                case '[object Symbol]':
                  if (X) return X.call(e) == X.call(t);
              }
              return !1;
            })(e, t, u, r, n, o, i)
      );
    if (!(1 & r)) {
      var d = l && Xe.call(e, '__wrapped__'),
        v = f && Xe.call(t, '__wrapped__');
      if (d || v) {
        var y = d ? e.value() : e,
          _ = v ? t.value() : t;
        return i || (i = new $()), o(y, _, r, n, i);
      }
    }
    return (
      !!h &&
      (i || (i = new $()),
      (function (e, t, r, n, o, a) {
        var i = 1 & r,
          s = Me(e),
          c = s.length;
        if (c != Me(t).length && !i) return !1;
        for (var u = c; u--; ) {
          var p = s[u];
          if (!(i ? p in t : Re.call(t, p))) return !1;
        }
        var l = a.get(e),
          f = a.get(t);
        if (l && f) return l == t && f == e;
        var h = !0;
        a.set(e, t), a.set(t, e);
        for (var d = i; ++u < c; ) {
          var v = e[(p = s[u])],
            y = t[p];
          if (n) var _ = i ? n(y, v, p, t, e, a) : n(v, y, p, e, t, a);
          if (!(void 0 === _ ? v === y || o(v, y, r, n, a) : _)) {
            h = !1;
            break;
          }
          d || (d = 'constructor' == p);
        }
        if (h && !d) {
          var b = e.constructor,
            g = t.constructor;
          b == g ||
            !('constructor' in e) ||
            !('constructor' in t) ||
            ('function' == typeof b && b instanceof b && 'function' == typeof g && g instanceof g) ||
            (h = !1);
        }
        return a.delete(e), a.delete(t), h;
      })(e, t, r, n, o, i))
    );
  }
  function Qe(e, t, r, n, o) {
    return e === t || (null == e || null == t || (!te(e) && !te(t)) ? e != e && t != t : Je(e, t, r, n, Qe, o));
  }
  class Ze {
    constructor({game: e, rendererSystem: t}) {
      (this.renderers = []), (this.game = e), (this.rendererSystem = t);
    }
    register(...e) {
      for (const t of e)
        (t.game = this.game),
          (t.rendererManager = this.rendererSystem.rendererManager),
          (t.containerManager = this.rendererSystem.containerManager),
          this.renderers.push(t);
    }
    componentChanged(e) {
      for (const r of e)
        for (const e of this.renderers) {
          const n = e.observerInfo[r.componentName];
          if (n) {
            if ([t.OBSERVER_TYPE.ADD, t.OBSERVER_TYPE.REMOVE].indexOf(r.type) > -1) {
              try {
                e.componentChanged && e.componentChanged(r);
              } catch (e) {
                console.error(`gameObject: ${r.gameObject.name}, ${r.componentName} is error.`, r, e);
              }
              continue;
            }
            if (
              n.findIndex(e => {
                return (t = e), (n = r.prop), Qe(t, n);
                var t, n;
              }) > -1
            )
              try {
                e.componentChanged && e.componentChanged(r);
              } catch (e) {
                console.error(
                  `gameObject: ${r.gameObject && r.gameObject.name}, ${r.componentName} is componentChanged error.`,
                  r,
                  e,
                );
              }
          }
        }
    }
    update(e) {
      for (const t of e.components)
        for (const r of this.renderers) {
          const n = [];
          if (r.observerInfo[t.name] && -1 === n.indexOf(e)) {
            n.push(e);
            try {
              r.rendererUpdate && r.rendererUpdate(e);
            } catch (r) {
              console.info(`gameObject: ${e.name}, ${t.name} is update error`, r);
            }
          }
        }
    }
  }
  class et {
    constructor() {
      this.containerMap = {};
    }
    addContainer({name: e, container: t}) {
      this.containerMap[e] = t;
    }
    getContainer(e) {
      return this.containerMap[e];
    }
    removeContainer(e) {
      var t;
      null === (t = this.containerMap[e]) || void 0 === t || t.destroy(!0), delete this.containerMap[e];
    }
    updateTransform({name: e, transform: t}) {
      const r = this.containerMap[e];
      if (!r) return;
      const {anchor: n, origin: o, position: a, rotation: i, scale: s, size: c, skew: u} = t;
      (r.rotation = i), (r.scale = s), (r.pivot.x = c.width * o.x), (r.pivot.y = c.height * o.y), (r.skew = u);
      let p = a.x,
        l = a.y;
      if (t.parent) {
        const e = t.parent;
        (p += e.size.width * n.x), (l += e.size.height * n.y);
      }
      r.position = {x: p, y: l};
    }
  }
  var tt = (function (e) {
    var t = {exports: {}};
    return e(t, t.exports), t.exports;
  })(function (e) {
    var t = Object.prototype.hasOwnProperty,
      r = '~';
    function n() {}
    function o(e, t, r) {
      (this.fn = e), (this.context = t), (this.once = r || !1);
    }
    function a(e, t, n, a, i) {
      if ('function' != typeof n) throw new TypeError('The listener must be a function');
      var s = new o(n, a || e, i),
        c = r ? r + t : t;
      return (
        e._events[c]
          ? e._events[c].fn
            ? (e._events[c] = [e._events[c], s])
            : e._events[c].push(s)
          : ((e._events[c] = s), e._eventsCount++),
        e
      );
    }
    function i(e, t) {
      0 == --e._eventsCount ? (e._events = new n()) : delete e._events[t];
    }
    function s() {
      (this._events = new n()), (this._eventsCount = 0);
    }
    Object.create && ((n.prototype = Object.create(null)), new n().__proto__ || (r = !1)),
      (s.prototype.eventNames = function () {
        var e,
          n,
          o = [];
        if (0 === this._eventsCount) return o;
        for (n in (e = this._events)) t.call(e, n) && o.push(r ? n.slice(1) : n);
        return Object.getOwnPropertySymbols ? o.concat(Object.getOwnPropertySymbols(e)) : o;
      }),
      (s.prototype.listeners = function (e) {
        var t = r ? r + e : e,
          n = this._events[t];
        if (!n) return [];
        if (n.fn) return [n.fn];
        for (var o = 0, a = n.length, i = new Array(a); o < a; o++) i[o] = n[o].fn;
        return i;
      }),
      (s.prototype.listenerCount = function (e) {
        var t = r ? r + e : e,
          n = this._events[t];
        return n ? (n.fn ? 1 : n.length) : 0;
      }),
      (s.prototype.emit = function (e, t, n, o, a, i) {
        var s = r ? r + e : e;
        if (!this._events[s]) return !1;
        var c,
          u,
          p = this._events[s],
          l = arguments.length;
        if (p.fn) {
          switch ((p.once && this.removeListener(e, p.fn, void 0, !0), l)) {
            case 1:
              return p.fn.call(p.context), !0;
            case 2:
              return p.fn.call(p.context, t), !0;
            case 3:
              return p.fn.call(p.context, t, n), !0;
            case 4:
              return p.fn.call(p.context, t, n, o), !0;
            case 5:
              return p.fn.call(p.context, t, n, o, a), !0;
            case 6:
              return p.fn.call(p.context, t, n, o, a, i), !0;
          }
          for (u = 1, c = new Array(l - 1); u < l; u++) c[u - 1] = arguments[u];
          p.fn.apply(p.context, c);
        } else {
          var f,
            h = p.length;
          for (u = 0; u < h; u++)
            switch ((p[u].once && this.removeListener(e, p[u].fn, void 0, !0), l)) {
              case 1:
                p[u].fn.call(p[u].context);
                break;
              case 2:
                p[u].fn.call(p[u].context, t);
                break;
              case 3:
                p[u].fn.call(p[u].context, t, n);
                break;
              case 4:
                p[u].fn.call(p[u].context, t, n, o);
                break;
              default:
                if (!c) for (f = 1, c = new Array(l - 1); f < l; f++) c[f - 1] = arguments[f];
                p[u].fn.apply(p[u].context, c);
            }
        }
        return !0;
      }),
      (s.prototype.on = function (e, t, r) {
        return a(this, e, t, r, !1);
      }),
      (s.prototype.once = function (e, t, r) {
        return a(this, e, t, r, !0);
      }),
      (s.prototype.removeListener = function (e, t, n, o) {
        var a = r ? r + e : e;
        if (!this._events[a]) return this;
        if (!t) return i(this, a), this;
        var s = this._events[a];
        if (s.fn) s.fn !== t || (o && !s.once) || (n && s.context !== n) || i(this, a);
        else {
          for (var c = 0, u = [], p = s.length; c < p; c++)
            (s[c].fn !== t || (o && !s[c].once) || (n && s[c].context !== n)) && u.push(s[c]);
          u.length ? (this._events[a] = 1 === u.length ? u[0] : u) : i(this, a);
        }
        return this;
      }),
      (s.prototype.removeAllListeners = function (e) {
        var t;
        return (
          e ? ((t = r ? r + e : e), this._events[t] && i(this, t)) : ((this._events = new n()), (this._eventsCount = 0)), this
        );
      }),
      (s.prototype.off = s.prototype.removeListener),
      (s.prototype.addListener = s.prototype.on),
      (s.prefixed = r),
      (s.EventEmitter = s),
      (e.exports = s);
  });
  let rt = class extends tt {
    constructor({system: e, containerManager: t}) {
      super(),
        (this.name = 'Transform'),
        (this.waitRemoveIds = []),
        (this.waitChangeScenes = []),
        (this.containerManager = t),
        this.init(e);
    }
    init(e) {
      (this.system = e),
        this.on('changeScene', ({scene: e, mode: t, application: r}) => {
          this.waitChangeScenes.push({scene: e, mode: t, application: r});
        });
    }
    update() {
      for (const e of this.waitRemoveIds) this.containerManager.removeContainer(e);
      this.waitRemoveIds = [];
      for (const e of this.waitChangeScenes) {
        const t = this.containerManager.getContainer(e.scene.id);
        t && (e.application.stage.removeChildren(), e.application.stage.addChild(t));
      }
      this.waitChangeScenes = [];
    }
    componentChanged(e) {
      e.type === t.OBSERVER_TYPE.ADD
        ? this.addContainer(e)
        : e.type === t.OBSERVER_TYPE.CHANGE
        ? this.change(e)
        : e.type === t.OBSERVER_TYPE.REMOVE && this.waitRemoveIds.push(e.gameObject.id);
    }
    addContainer(e) {
      const t = new r.Container();
      (t.name = e.gameObject.name), this.containerManager.addContainer({name: e.gameObject.id, container: t});
      e.component.worldTransform = t.transform.worldTransform;
    }
    change(e) {
      const t = e.component;
      if (t.parent) {
        this.containerManager.getContainer(t.parent.gameObject.id).addChild(this.containerManager.getContainer(e.gameObject.id));
        const r = e.gameObject.transform.parent && e.gameObject.transform.parent.gameObject.getComponent('Render');
        r && (r.sortDirty = !0);
      } else {
        const r = this.containerManager.getContainer(e.gameObject.id);
        delete t.worldTransform, r.parent && r.parent.removeChild(r);
      }
    }
    destroy() {
      this.removeAllListeners(),
        (this.waitRemoveIds = null),
        (this.waitChangeScenes = null),
        (this.system = null),
        (this.containerManager = null);
    }
  };
  rt = o([t.decorators.componentObserver({Transform: ['_parent']})], rt);
  var nt,
    ot = rt;
  (e.RENDERER_TYPE = void 0),
    ((nt = e.RENDERER_TYPE || (e.RENDERER_TYPE = {}))[(nt.UNKNOWN = 0)] = 'UNKNOWN'),
    (nt[(nt.WEBGL = 1)] = 'WEBGL'),
    (nt[(nt.CANVAS = 2)] = 'CANVAS');
  const at = e => {
      (e.plugins.interaction.autoPreventDefault = !0), (e.view.style.touchAction = 'none');
    },
    it = e => {
      (e.plugins.interaction.autoPreventDefault = !1), (e.view.style.touchAction = 'auto');
    };
  let st = class extends t.System {
    constructor() {
      super(...arguments), (this.multiApps = []);
    }
    init(e) {
      (this.params = e),
        (this.application = this.createApplication(e)),
        (this.containerManager = new et()),
        (this.rendererManager = new Ze({game: this.game, rendererSystem: this})),
        (this.game.canvas = this.application.view),
        (this.transform = new ot({system: this, containerManager: this.containerManager})),
        this.game.on('sceneChanged', ({scene: e, mode: r, params: n}) => {
          let o;
          switch (r) {
            case t.LOAD_SCENE_MODE.SINGLE:
              o = this.application;
              break;
            case t.LOAD_SCENE_MODE.MULTI_CANVAS:
              o = this.createMultiApplication({params: n});
          }
          (e.canvas = o.view), this.transform.emit('changeScene', {scene: e, mode: r, application: o});
        });
    }
    registerObserver(e) {
      const t = this.constructor.observerInfo;
      for (const r in e) t[r] || (t[r] = []), t[r].push(...e[r]);
    }
    createMultiApplication({params: e}) {
      const t = this.createApplication(e);
      return this.multiApps.push(t), t;
    }
    createApplication(t) {
      (t.view = t.canvas),
        t.renderType === e.RENDERER_TYPE.CANVAS && (t.forceCanvas = !0),
        (n.ticker.shared.autoStart = !1),
        n.ticker.shared.stop();
      const o = new r.Application(Object.assign({sharedTicker: !0}, t));
      return (
        void 0 !== t.preventScroll &&
          (console.warn(
            'PreventScroll property will deprecate at next major version, please use enableEnable instead. https://eva.js.org/#/tutorials/game',
          ),
          t.preventScroll ? it(o.renderer) : at(o.renderer)),
        void 0 !== t.enableScroll && (t.enableScroll ? it(o.renderer) : at(o.renderer)),
        void 0 === t.preventScroll && void 0 === t.enableScroll && it(o.renderer),
        o
      );
    }
    update() {
      const e = this.componentObserver.clear();
      for (const t of e) this.transform.componentChanged(t);
      for (const e of this.game.gameObjects)
        this.containerManager.updateTransform({name: e.id, transform: e.transform}), this.rendererManager.update(e);
    }
    lateUpdate(e) {
      this.transform.update(), this.application.ticker.update(e.time);
    }
    onDestroy() {
      this.application.destroy();
      for (const e of this.multiApps) e && e.destroy();
      this.transform.destroy(),
        (this.transform = null),
        (this.params = null),
        (this.rendererManager = null),
        (this.containerManager = null),
        (this.application = null),
        (this.game = null),
        (this.multiApps = null);
    }
    resize(e, t) {
      (this.params.width = e), (this.params.height = t), this.application.renderer.resize(e, t);
    }
  };
  (st.systemName = 'Renderer'), (st = o([t.decorators.componentObserver({Transform: ['_parent']})], st));
  var ct = st;
  class ut extends t.System {
    constructor(e) {
      super(e), (this.observerInfo = this.constructor.observerInfo);
    }
    componentChanged(e) {}
    rendererUpdate(e) {}
    update() {
      const e = this.componentObserver.clear();
      for (const t of e) this.componentChanged(t);
    }
  }
  (e.ContainerManager = et),
    (e.Renderer = ut),
    (e.RendererManager = Ze),
    (e.RendererSystem = ct),
    Object.defineProperty(e, '__esModule', {value: !0});
});
